<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Icebreaker Generator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f9c5bd;
            margin: 0;
            padding: 20px;
            color: #333;
            transition: background-color 0.5s ease;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background-color: #f5f5f5;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        h1 {
            margin: 0;
            font-size: 32px;
        }
        
        main {
            padding: 20px;
        }
        
        p {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        #en-button {
            background-color: #f47b7b;
            color: white;
        }
        
        #fr-button {
            background-color: #4acea3;
            color: white;
        }
        
        #jp-button {
            background-color: #ffd15c;
            color: #333;
        }
        
        #keanu-button {
            background-color: #2193b0;
            color: white;
        }
        
        .result {
            background-color: #f9f9f9;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #result-text {
            font-size: 18px;
            margin: 0;
        }
        
        .copy-btn {
            position: absolute;
            bottom: -15px;
            right: 15px;
            width: 36px;
            height: 36px;
            background-color: #f47b7b;
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            transform: scale(1.1);
        }
        
        footer {
            text-align: center;
            padding: 20px;
            border-top: 1px solid #eee;
            color: #777;
            font-size: 14px;
        }
        
        a {
            color: #4a6ee0;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        .coffee-mug {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 150px; /* 2.5x larger */
            height: 150px; /* 2.5x larger */
            background-color: #d32f2f;
            border-radius: 15px 15px 75px 75px;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .coffee-handle {
            position: absolute;
            right: -45px;
            top: 35px;
            width: 45px;
            height: 60px;
            border: 10px solid #d32f2f;
            border-left: none;
            border-radius: 0 50px 50px 0;
        }
        
        .coffee-content {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 70%;
            background-color: #6f4e37; /* Default coffee color */
            border-radius: 0 0 75px 75px;
        }
        
        .steam {
            position: absolute;
            top: -25px;
            left: 50px;
            width: 50px;
            height: 60px;
            opacity: 0.7;
            filter: blur(8px);
            animation: steaming 3s infinite;
        }
        
        @keyframes steaming {
            0% { transform: translateY(0) scale(1); opacity: 0.7; }
            50% { transform: translateY(-20px) scale(1.2); opacity: 0.4; }
            100% { transform: translateY(-40px) scale(0.8); opacity: 0; }
        }
        
        .steam:before,
        .steam:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            border-radius: 50%;
        }
        
        .steam:after {
            bottom: -15px;
            left: 15px;
        }
        
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: #f5f5f5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .dark-mode-toggle:hover {
            transform: scale(1.1);
        }
        
        /* Dark mode */
        body.dark-mode {
            background-color: #222;
            color: #f5f5f5;
        }
        
        body.dark-mode .container {
            background-color: #333;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        body.dark-mode header {
            background-color: #444;
            border-bottom: 1px solid #555;
        }
        
        body.dark-mode .result {
            background-color: #444;
            color: #f5f5f5;
        }
        
        body.dark-mode footer {
            border-top: 1px solid #555;
            color: #aaa;
        }
        
        body.dark-mode a {
            color: #7a96e0;
        }
        
        body.dark-mode .dark-mode-toggle {
            background-color: #444;
            color: #f5f5f5;
        }
    </style>
</head>
<body>
    <div class="dark-mode-toggle" onclick="toggleDarkMode()">‚òÄÔ∏è</div>
    
    <div class="container">
        <header>
            <h1 id="title">Icebreaker</h1>
        </header>
        
        <main>
            <p id="subtitle">Start a conversation with an icebreaker.</p>
            
            <div class="buttons">
                <button id="en-button">English</button>
                <button id="fr-button">Fran√ßais</button>
                <button id="jp-button">Êó•Êú¨Ë™û</button>
                <button id="keanu-button">Keanu Mode</button>
            </div>
            
            <div class="result">
                <p id="result-text">Click any button above to generate an icebreaker!</p>
                <button onclick="copyToClipboard()" class="copy-btn" title="Copy to clipboard">‚éò</button>
            </div>
        </main>
        
        <footer>
            <p>¬© 2025 <a href="https://github.com/lingasc">lingasc</a> | <span id="footer-text">Start your day with bright conversations</span></p>
        </footer>
    </div>
    
    <div class="coffee-mug" onclick="changeMugColor()">
        <div class="coffee-handle"></div>
        <div class="coffee-content" ondblclick="changeCoffeeType()"></div>
        <div class="steam"></div>
    </div>
    
    <script>
        // DOM elements
        const title = document.getElementById('title');
        const subtitle = document.getElementById('subtitle');
        const resultText = document.getElementById('result-text');
        const footerText = document.getElementById('footer-text');
        const coffeeMug = document.querySelector('.coffee-mug');
        const coffeeMugHandle = document.querySelector('.coffee-handle');
        const coffeeContent = document.querySelector('.coffee-content');
        
        // Current state
        let currentLanguage = 'en';
        let currentText = '';
        let prefersDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        let coffeeType = 'black'; // Default coffee type
        
        // Initialize dark mode based on system preference
        if (prefersDarkMode) {
            document.body.classList.add('dark-mode');
            document.querySelector('.dark-mode-toggle').textContent = 'üåô';
        }
        
        // Load requirements.py when page loads
        window.addEventListener('DOMContentLoaded', () => {
            fetchIcebreaker('requirements');
        });
        
        // Button click handlers
        document.getElementById('en-button').addEventListener('click', () => fetchIcebreaker('en'));
        document.getElementById('fr-button').addEventListener('click', () => fetchIcebreaker('fr'));
        document.getElementById('jp-button').addEventListener('click', () => fetchIcebreaker('jp'));
        document.getElementById('keanu-button').addEventListener('click', () => fetchIcebreaker('keanu'));
        
        // Fetch icebreaker from server
        async function fetchIcebreaker(language) {
            try {
                // Show loading state
                resultText.textContent = 'Loading...';
                
                let endpoint;
                switch (language) {
                    case 'en':
                        endpoint = '/generate_english';
                        break;
                    case 'fr':
                        endpoint = '/generate_french';
                        break;
                    case 'jp':
                        endpoint = '/generate_japanese';
                        break;
                    case 'keanu':
                        endpoint = '/generate_keanu';
                        break;
                    case 'requirements':
                        endpoint = '/';
                        break;
                }
                
                const response = await fetch(endpoint);
                
                if (!response.ok) {
                    throw new Error(`Error: ${response.status}`);
                }
                
                const data = await response.json();
                currentLanguage = language;
                
                // Update UI with the received data
                if (language !== 'requirements') {
                    updateUI(data);
                }
            } catch (error) {
                console.error('Error fetching icebreaker:', error);
                resultText.textContent = 'Failed to load icebreaker. Please try again.';
            }
        }
        
        // Update UI with data from the server
        function updateUI(data) {
            title.textContent = data.title || title.textContent;
            subtitle.textContent = data.subtitle || subtitle.textContent;
            resultText.textContent = data.icebreaker || 'No icebreaker available';
            footerText.textContent = data.footer || footerText.textContent;
            currentText = data.icebreaker || '';
            
            // Update copy button color
            document.querySelector('.copy-btn').style.backgroundColor = 
                currentLanguage === 'en' ? '#f47b7b' : 
                currentLanguage === 'fr' ? '#4acea3' : 
                currentLanguage === 'jp' ? '#ffd15c' : '#2193b0';
        }
        
        // Copy to clipboard
        function copyToClipboard() {
            if (currentText) {
                navigator.clipboard.writeText(currentText)
                    .then(() => {
                        const copyBtn = document.querySelector('.copy-btn');
                        copyBtn.textContent = '‚úì';
                        copyBtn.title = 'Copied!';
                        setTimeout(() => {
                            copyBtn.textContent = '‚éò';
                            copyBtn.title = 'Copy to clipboard';
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Could not copy text: ', err);
                    });
            }
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            const body = document.body;
            const darkModeToggle = document.querySelector('.dark-mode-toggle');
            
            body.classList.toggle('dark-mode');
            
            if (body.classList.contains('dark-mode')) {
                darkModeToggle.textContent = 'üåô';
            } else {
                darkModeToggle.textContent = '‚òÄÔ∏è';
            }
        }
        
        // Change mug color
        function changeMugColor() {
            const colors = ['#d32f2f', '#388e3c', '#1976d2', '#ffa000', '#7b1fa2', '#e64a19', '#00897b'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            coffeeMug.style.backgroundColor = randomColor;
            coffeeMugHandle.style.borderColor = randomColor;
        }
        
        // Change coffee type
        function changeCoffeeType() {
            switch (coffeeType) {
                case 'black':
                    // Change to espresso
                    coffeeContent.style.backgroundColor = '#3c2415';
                    coffeeContent.style.height = '40%';
                    coffeeType = 'espresso';
                    break;
                case 'espresso':
                    // Change to latte
                    coffeeContent.style.backgroundColor = '#c6a47f';
                    coffeeContent.style.height = '70%';
                    coffeeType = 'latte';
                    break;
                case 'latte':
                    // Change to cappuccino
                    coffeeContent.style.backgroundColor = '#b08b63';
                    coffeeContent.style.height = '70%';
                    coffeeType = 'cappuccino';
                    break;
                case 'cappuccino':
                    // Change to black coffee
                    coffeeContent.style.backgroundColor = '#6f4e37';
                    coffeeContent.style.height = '70%';
                    coffeeType = 'black';
                    break;
            }
        }
        
        // Fallback data for GitHub Pages (when server is not available)
        const fallbackData = {
            en: {
                title: "Icebreaker",
                subtitle: "Start a conversation with an icebreaker.",
                footer: "Start your day with bright conversations",
                icebreakers: [
                    "If you could have dinner with any historical figure, who would it be and why?",
                    "What's the most interesting place you've ever visited?",
                    "If you could instantly become an expert in something, what would it be?",
                    "What's your favorite book or movie and why does it resonate with you?",
                    "If you could live in any fictional world, which would you choose?"
                ]
            },
            fr: {
                title: "Brise-Glace",
                subtitle: "Commencez une conversation avec un brise-glace.",
                footer: "Commencez votre journ√©e avec des conversations brillantes",
                icebreakers: [
                    "Si vous pouviez d√Æner avec n'importe quelle figure historique, qui choisiriez-vous et pourquoi?",
                    "Quel est l'endroit le plus int√©ressant que vous ayez jamais visit√©?",
                    "Si vous pouviez instantan√©ment devenir expert en quelque chose, que serait-ce?",
                    "Quel est votre livre ou film pr√©f√©r√© et pourquoi vous touche-t-il?",
                    "Si vous pouviez vivre dans n'importe quel monde fictif, lequel choisiriez-vous?"
                ]
            },
            jp: {
                title: "‰ºöË©±Ë°ì",
                subtitle: "‰ºöË©±„ÇíÂßã„ÇÅ„Çã„Åç„Å£„Åã„Åë„Å´‰Ωø„ÅÑ„Åæ„Åó„Çá„ÅÜ„ÄÇ",
                footer: "‰ºöË©±„ÅßÊòé„Çã„ÅÑ‰∏ÄÊó•„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜ",
                icebreakers: [
                    "Ê≠¥Âè≤‰∏ä„ÅÆ‰∫∫Áâ©„Å®Â§ïÈ£ü„ÇíÂÖ±„Å´„Åß„Åç„Çã„Å®„Åó„Åü„Çâ„ÄÅË™∞„ÇíÈÅ∏„Å≥„Åæ„Åô„ÅãÔºü„Åæ„Åü„ÄÅ„Åù„ÅÆÁêÜÁî±„ÅØÔºü",
                    "‰ªä„Åæ„ÅßË®™„Çå„Åü‰∏≠„ÅßÊúÄ„ÇÇËààÂë≥Ê∑±„ÅÑÂ†¥ÊâÄ„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü",
                    "‰∏ÄÁû¨„Åß„Ç®„Ç≠„Çπ„Éë„Éº„Éà„Å´„Å™„Çå„Çã„Å®„Åó„Åü„Çâ„ÄÅ‰Ωï„ÇíÈÅ∏„Å≥„Åæ„Åô„ÅãÔºü",
                    "„ÅÇ„Å™„Åü„ÅÆ„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÊú¨„ÇÑÊò†Áîª„ÅØ‰Ωï„Åß„Åô„ÅãÔºü„Åù„Çå„ÅØ„Å™„Åú„ÅÇ„Å™„Åü„ÅÆÂøÉ„Å´Èüø„Åè„ÅÆ„Åß„Åô„ÅãÔºü",
                    "„Å©„Çì„Å™„Éï„Ç£„ÇØ„Ç∑„Éß„É≥„ÅÆ‰∏ñÁïå„Å´‰Ωè„ÇÄ„Åì„Å®„Åå„Åß„Åç„Çã„Å®„Åó„Åü„Çâ„ÄÅ„Å©„Åì„ÇíÈÅ∏„Å≥„Åæ„Åô„ÅãÔºü"
                ]
            },
            keanu: {
                title: "Keanu Mode",
                subtitle: "Learn something amazing about Keanu Reeves.",
                footer: "Keanu Reeves gives up his seat on the subway for pregnant women!",
                icebreakers: [
                    "Keanu Reeves once helped a stranded stranger by driving her 50 miles out of his way.",
                    "Keanu Reeves gave away a significant portion of his Matrix earnings to the special effects team.",
                    "Keanu Reeves often takes pay cuts so films can hire other actors they want.",
                    "Keanu Reeves secretly funds children's hospitals and doesn't attach his name to the donations.",
                    "It's possible that Keanu Reeves accidentally married Winona Ryder."
                ]
            }
        };
        
        // In case of fetch error, use fallback data for GitHub Pages
        window.addEventListener('error', function(e) {
            if (e.target.tagName.toLowerCase() === 'script') {
                console.log('Script error occurred. Setting up GitHub Pages fallback.');
                setupGitHubPagesFallback();
            }
        }, true);
        
        // Setup GitHub Pages fallback for when server endpoints are not available
        function setupGitHubPagesFallback() {
            // Override the fetchIcebreaker function for GitHub Pages
            window.fetchIcebreaker = function(language) {
                if (language === 'requirements') return; // Skip requirements for GitHub Pages
                
                currentLanguage = language;
                
                const data = fallbackData[language];
                const randomIndex = Math.floor(Math.random() * data.icebreakers.length);
                
                const gitHubPagesData = {
                    title: data.title,
                    subtitle: data.subtitle,
                    icebreaker: data.icebreakers[randomIndex],
                    footer: data.footer
                };
                
                updateUI(gitHubPagesData);
            };
            
            // Re-add event listeners with the new function
            document.getElementById('en-button').onclick = () => fetchIcebreaker('en');
            document.getElementById('fr-button').onclick = () => fetchIcebreaker('fr');
            document.getElementById('jp-button').onclick = () => fetchIcebreaker('jp');
            document.getElementById('keanu-button').onclick = () => fetchIcebreaker('keanu');
        }
        
        // Check if we're on GitHub Pages by trying to access the server
        fetch('/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Not running on server');
                }
            })
            .catch(error => {
                console.log('Running on GitHub Pages, setting up fallback mode');
                setupGitHubPagesFallback();
            });
    </script>
</body>
</html>
